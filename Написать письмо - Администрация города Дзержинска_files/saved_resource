window.GmI=window.GmI||function(){function t(r){t._.busy?t._.delayed.push(r):this.init(r)}var r=t.prototype,e=t._={},a=t.D={},s=t.F={},n=t.T={};return r.id="",r.doc=null,r.win=null,r.args={},r.prox={},r.target=null,r.init=function(r){var e="",a="";return t._.busy=!0,r?r.slug?r.type?t[e]&&(a="informer_exists"):a="config_no_informer_id":a="config_no_partner_id":a="config_not_given",a?void t._.report(a):(this.args={},this.args.city=r.city?r.city.replace(/[^\d,]/g,""):"auto",this.args.lang=r.lang?r.lang.replace(/\W/g):"ru",this.args.slug=r.slug.replace(/[ \s\t\r]/g,""),this.args.type=r.type.replace(/[ \s\t\r]/g,""),this.args.path=r.path?r.path:"",this.args.funcs="object"==typeof r.funcs?r.funcs:{},this.args.order=this.args.city.split(",").slice(0,20),this.args.width=r.width?r.width+"":"auto",this.args.height=r.height?r.height+"":"auto",this.id=e=this.args.type+"_"+this.args.lang,this.args.path?this.target=t._.doc.querySelector(this.args.path):this.target=t._.doc.querySelector("#GMI_"+e+",#GMI_"+e+"_"+this.args.city.replace(/,/g,"")),void(this.target?(t[e]=this,t.installed.push(e),this.prox={},this.prox.adjust=t._.proxy(this.adjust,this),this.layout()):t._.report("dom_target_not_found",this.id)))},r.fire=function(t){this.args.funcs[t]&&this.args.funcs[t].call(this.target,this)},r.adjust=function(){var t=this.args.width,r=this.args.height;"auto"===t?this._iframe.width=this.doc.body.firstChild.offsetWidth:this._iframe.width=t,"auto"===r?this._iframe.height=this.doc.body.firstChild.offsetHeight:this._iframe.height=r},r.inject=function(){var r=this._iframe=t._.doc.createElement("iframe");this.fire("iframe_render_start"),r.allowTransparency=!0,r.frameBorder=0,r.height="number"==typeof this.args.height?this.args.height:0,r.width="number"==typeof this.args.width?this.args.width:0,r.scrolling="no",r.src="about:blank",r.style.display="block",this.target.innerHTML="",this.target.appendChild(r),this.win=r.contentWindow,this.doc=this.win.document,this.doc.open("text/html","replace"),this.doc.write('<!DOCTYPE html><html><head><meta charset="UTF-8"><style type="text/css">'+t.D.styles[this.args.type]+'</style><title>Gismeteo Informer</title></head><body class="info info_lang_'+this.args.lang+" info_layout_"+this.args.type+(t._.ie?" info_ie_"+t._.ie:"")+'"></body></html>'),this.doc.close(),this.render(this.doc.body,t.D.layouts[this.args.type],"fa",0,0,0),this.win.onload=this.prox.adjust,this.win.onresize=this.prox.adjust,t._.ie?setTimeout(this.win.onresize,150):this.win.onresize(),this.fire("iframe_render_finish"),t._.next()},r.layout=function(r){var e="";if(void 0===r)this.fire("layout_download_start"),t.D.layouts[this.args.type]&&t.D.langs[this.args.lang]?(this.records(),this.fire("layout_download_finish")):t._.request("layout",{type:this.args.type,lang:this.args.lang});else if("object"==typeof r){if(r.error)return void t._.report(r.error,this.id);if(!r.lang)return void t._.report("layout_no_lang",this.id);if(!r.output)return void t._.report("layout_no_output",this.id);if(!r.styles)return void t._.report("layout_no_styles",this.id);r.static_servers&&(e=Math.floor(Math.random()*r.static_servers.length),e=r.static_servers[e]),t._.urls.icons=t._.urls.icons.replace("$server",e),t._.urls.home=r.server_name,this.fire("layout_download_finish"),t.D.langs[this.args.lang]=r.lang,t.D.styles[this.args.type]=r.styles,t.D.layouts[this.args.type]=r.output,this.records()}},r.render=function(r,e,a,s,n,i){var o=3,l=s,g=0,u=s+1,h=(e.scope?e.scope.toLowerCase().substring(0,2):"fa",e.every),c=t.T[e.name]?"trigger":"section",d=Array.prototype.slice.call(arguments),_=this.args.order;for(h&&("city"===h?(o=3,_=this.args.order):"day"===h?(o=4,_=t.D.weather[this.args.order[s]].days,e.limit=e.limit||3,"fa"===d[2]&&(d[2]="fo")):"daypart"===h&&(o=5,_=t.D.weather[this.args.order[s]].days[n][a]?t.D.weather[this.args.order[s]].days[n][a]:t.D.weather[this.args.order[s]].days[n].fo,e.limit=e.limit||3,"fa"===d[2]&&(d[2]="fo")),l=e.first?e.first:0,u=e.limit?e.limit:_.length);l<u;l++)g=l,"daypart"===h?(d[4]=d[4]+1,_=t.D.weather[this.args.order[s]].days[d[4]].fo,g=_.length-(_.length-l)):"day"===h&&(d[5]=Math.floor((new Date).getHours()/6)-1),d[o]=g,this[c].apply(this,d)},r.records=function(r){var e=0,a=0,s=0,n=0,i="",o=null,l=null,g=null,u=null,h=[];if(void 0===r){for(this.fire("records_download_start"),e=0,s=this.args.order.length;e<s;e++)i=this.args.order[e],t.D.weather[i]&&t.D.langs[this.args.lang][i]||h.push(i);h.length?t._.request("records",{city:1===h.length?h.join(","):"auto",lang:this.args.lang,slug:this.args.slug,type:this.args.type}):this.inject()}else if("object"==typeof r){if(r.error)return void t._.report(r.error,this.id);if(!r.weather)return void t._.report("data_no_cities",this.id);if(!r.partner)return void t._.report("data_no_partner",this.id);this.fire("records_download_finish"),t.D.partner=r.partner,"auto"===this.args.order[0]&&(this.args.order=t.D.partner.order.slice());for(i in r.weather)for(l=t.D.weather[i]=r.weather[i],g=t.D.langs[this.args.lang][i]={name:l.name,fa:[],fo:[]},e=0,s=l.days.length;e<s;e++){if(o=l.days[e],o.fa)for(g.fa=[],a=0,n=o.fa.length;a<n;a++)u=o.fa[a],g.fa.push(u.weather.text);if(o.fo)for(g.fo=[],a=0,n=o.fo.length;a<n;a++)u=o.fo[a],g.fo.push(u.weather.text)}this.inject()}},r.section=function(r,e,a,s,n,i){var o=0,l=e.data?e.data.length:0,g="",u=t._.node.call(this,"section section_for_"+e.name,"",e.link?"a":"span");for(g in e)"data"!==g&&"link"!==g&&"name"!==g&&"every"!==g&&"first"!==g&&"limit"!==g&&"string"==typeof e[g]&&(u.className+=" section_"+g+"_"+e[g]);if((e.link+"").match(/(widget|weather)/)&&(u.href=t.D.weather[this.args.order[s]][e.link+"_link"],u.target="_blank"),e.css)for(g in e.css)u.style[g]=e.css[g];if(e.data instanceof Array)for(;o<l;o++)this.render(u,e.data[o],a,s,n,i);r.appendChild(u)},r.trigger=function(r,e,a,s,n,i){var o=this.args.order[s],l="",g=t.D.weather[o],u=null,h={};g.days[n][a]&&(u=g.days[n][a][i]);for(l in u)h[l]=u[l];h.args={};for(l in e)h.args[l]=e[l];h.off={gmt:g.gmt,day:n,ctxt:a,city:o,part:i,moon:g.days[n].moon},r.appendChild(t.T[e.name].call(this,h))},t.version=3,t.installed=[],t.url=function(r,e,a){e=e||{};var s=typeof e,n="",i="";if(t._.urls[r]){if("string"===s)return t._.urls[r]=e,!0;if("object"===s){i=t._.urls[r];for(n in e)i=i.replace(new RegExp("\\$"+n,"g"),t._.win.encodeURIComponent(e[n]));return a!==!1&&(i+=(i.indexOf("?")===-1?"?":"&")+"callback=GmI._.loaded"),i}}return!1},t.uninstall=function(r){if(r&&t[r]){var e=t.installed.length,a=-1;for(t[r].target&&(t[r].target.innerHTML=""),delete t[r];e-- >0;)r===t.installed[e]&&(a=e);t.installed=t.installed.splice(a,1)}},e.dev=!(!this.MG||!this.MG.Config.development),e.busy=!1,e.ie=this.navigator.userAgent.match(/MSIE (6|7|8)/)?this.navigator.userAgent.replace(/.*MSIE (6|7|8).*/,"$1")-0:0,e.urls={},e.urls.home=e.dev?"/":"//www.gismeteo.ru/",e.urls.root=e.urls.home+"informers/",e.urls.error=e.urls.root+"error/?id=$id&ms=$ms&ts=$ts",e.urls.icons=(e.dev?"/":"$server/")+"assets/flat-ui/img/icons/$type/$pack/$size/$file.png",e.urls.layout=e.urls.home+"api/informer/layout.js/$type/$lang/",e.urls.records=e.urls.home+"api/informer/data.js/$slug/$type/$lang/?city=$city",e.win=this,e.doc=this.document,e.delayed=[],e.transport=null,e.next=function(){if(t._.busy=!1,t._.delayed.length)try{new t(t._.delayed.splice(0,1)[0])}catch(r){}},e.node=function(t,r,e){r=r||"",e=e||"span";var a=this.doc.createElement(e);return a.className=t,r&&"string"==typeof r&&(a.innerHTML=r),a},e.proxy=function(t,r){var e=Array.prototype.slice.call(arguments,2);return function(){return t.apply(r,[].concat(e,Array.prototype.slice.call(arguments)))}},e.loaded=function(r){r&&r.data?void 0!==r.data[1].output?t[r.data[0]].layout(r.data[1]):void 0!==r.data[1].weather&&t[r.data[0]].records(r.data[1]):t._.report(r.data[0],"data_not_loaded")},e.report=function(r,e){e=e||"",e&&t.uninstall(e),t._.delayed.length&&t._init()},e.request=function(r,e,a){t._.transport&&t._.doc.body.removeChild(t._.transport),t._.transport=t._.doc.createElement("script"),t._.transport.async=!0,t._.transport.src=t.url(r,e,a),t._.transport.type="text/javascript",t._.doc.body.appendChild(t._.transport)},a.langs={},a.styles={},a.layouts={},a.partner={},a.weather={},s.date=function(r,e,a){var s=0,n=r.match(/(\w+|\W|\s)/g),i=e?new Date(e):new Date,o={D:function(t,r){return r.days.part[t.getDay()]},F:function(r,e){return e.months.full[t.F.timeunit(r.getMonth()+1)]},G:function(t,r){return t.getHours()-0},H:function(r,e){return t.F.timeunit(r.getHours())},L:function(t,r){return 1!==new Date(t.getFullYear(),1,29).getDate()?1:0},M:function(r,e){return e.months.part[t.F.timeunit(r.getMonth()+1)]},N:function(t,r){var e=t.getDay();return 0===e?7:e},S:function(r,e){return e.months.decl[t.F.timeunit(r.getMonth()+1)]},Y:function(t,r){return t.getFullYear()},d:function(r,e){return t.F.timeunit(r.getDate())},i:function(r,e){return t.F.timeunit(r.getMinutes())},j:function(t,r){return t.getDate()},l:function(t,r){return r.days.full[t.getDay()]},m:function(r,e){return t.F.timeunit(r.getMonth()+1)},n:function(t,r){return t.getMonth()+1},s:function(r,e){return t.F.timeunit(r.getSeconds())},t:function(t,r){return new Date(t.getFullYear(),t.getMonth(),0).getDate()},w:function(t,r){return t.getDay()},y:function(t,r){return(t.getFullYear()+"").substr(-2)}};for(s=n.length;s-- >0;)o[n[s]]&&(n[s]=o[n[s]](i,a));return n.join("")},s.moon=function(t,r){var e=t.icon,a=t.moonphase.label,n="none";return a.match(/\s/gi)&&(a=s.capitalizeFirstLetter(a.split(" ")[1])),{lum:t.phases.current,phase:e,alias:n,title:a}},s.round=function(t,r){r=r||1;var e=Math.pow(10,r);return Math.round(t*e)/e},s.plural=function(t,r,e,a){a=a||e;var s=t%100;if(s>10&&s<20)return a;switch(t%10){case 1:return r;case 2:case 3:case 4:return e}return a},s.timeunit=function(t){return("0"+t).slice(-2)},s.pressure=function(r,e){return"h"===e?t.F.round(.75006375541921*r):"i"===e?t.F.round(r/25.4):t.F.round(r)},s.windspeed=function(r,e){return"kh"===e?t.F.round(r/1e3*3600):"mh"===e?t.F.round(.000621371192*r*3600):t.F.round(r)},s.windtrend=function(t,r,e){var a=Math.floor(t/45),s=r?a+1:0;return 9===s&&(s=1),{alias:"c,n,ne,e,se,s,sw,w,nw".split(",")[s],grads:t,title:e[s]}},s.temperature=function(r,e){var a=r,s="";return"f"===e&&(a=t.F.round(1.8*a+32,0)),s=a+"",s=a<0?"&minus;"+s.replace(/-/,""):a>0?"+"+s.replace(/\+/,""):s.replace(/[+-]/,"")},s.capitalizeFirstLetter=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},n._sign=function(r,e,a,s){if(r){var n=a.name.replace(/([^_]*).*/,"$1"),i=t._.node.call(this,"sign",s||t.D.langs[this.args.lang].signs[n]);return e&&(e.className+=" "+n+"_has_sign",e.insertBefore(i,e.firstChild)),i}},n._unit=function(r,e,a,s){r&&e.appendChild(t._.node.call(this,"unit",s||t.D.langs[this.args.lang].units[a][t.D.partner.units[a]]))},n._part=function(r,e,a,s){var n="",i=t._.node.call(this,r+(e?" "+r+"_by_"+e:""),"icon"!==e?s:"");"icon"===e&&(a.no_title||(i.title=s));for(n in a)"large"!==n&&"small"!==n||(i.className+=" "+r+"_size_"+n);return i},n.logo=function(r){var e=t._.node.call(this,"logo","","a");return e.appendChild(t._.node.call(this,"gis","Gis")),e.appendChild(t._.node.call(this,"meteo","meteo")),e},n.forecast=function(r){var e=(r.limit,t._.node.call(this,"forecast","","a")),a=t.D.langs[this.args.lang];return e.appendChild(t._.node.call(this,"fore",a.forecast.title,"u")),e.href=t.D.weather[r.off.city].weather_link,e.target="_target",e},n.air_by_text=function(r){var e=t.T._part.call(this,"air","text",r.args,r.args.no_value?"":t.F.temperature(r.air,t.D.partner.units.temperature));return t.T._sign.call(this,r.args.sign,e,r.args),r.args.no_unit?e.className+=" air_no_unit":t.T._unit.call(this,!0,e,"temperature"),e},n.now_by_text=function(r){var e=new Date,a=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getUTCHours()+(r.off.gmt-0),e.getMinutes()),s=t.T._part.call(this,"now","text",r.args,t.F.date(r.args.format?r.args.format:"D, G:i",a,t.D.langs[this.args.lang].date));return t.T._sign.call(this,r.args.sign,s,r.args),s},n.sun_by_icon=function(r){var e=t.D.langs[this.args.lang],a=t.T._part.call(this,"sun","icon",r.args,e.signs.sun);return a.style.backgroundImage="url("+t.url("icons",{file:"shines",pack:"default",size:r.args.small?"24x24":"48x48",type:"sun"},!1)+")",a},n.sun_by_text=function(r){var e=t.D.langs[this.args.lang],a=t.T._part.call(this,"sun","text",r.args,e.signs.sun);return a},n.city_by_text=function(r){var e=t.T._part.call(this,"city","text","");return r.args.no_value||(e.innerHTML=t.D.weather[r.off.city].name,e.title=t.D.weather[r.off.city].name),t.T._sign.call(this,r.args.sign,e,r.args),e},n.date_by_text=function(r,e){var a=r.time.split(" "),s=new Date,n=null;return s.setFullYear(a[0]),s.setMonth(a[1]-1),s.setDate(a[2]),e||(s.setHours(a[3]),s.setMinutes(a[4])),n=t.T._part.call(this,"date","text",r.args,t.F.date(r.args.format?r.args.format:"D, G:i",s,t.D.langs[this.args.lang].date)),t.T._sign.call(this,r.args.sign,n,r.args),n},n.moon_by_icon=function(r){var e=t.D.langs[this.args.lang],a=t.F.moon(r.astro,t.D.langs[this.args.lang].units.moon),s=t.T._part.call(this,"moon","icon",r.args,(r.no_sign?a.title:e.signs.moon+" "+a.title.toLowerCase())+" ("+a.lum+"%)");return s.className+=" moon_is_"+a.phase,s.style.backgroundImage="url("+t.url("icons",{file:a.phase,pack:"default",size:r.args.small?"24x24":"48x48",type:"moon"},!1)+")",s},n.moon_by_text=function(r){var e=t.D.langs[this.args.lang],a=t.F.moon(r.astro,t.D.langs[this.args.lang].units.moon),s=t.T._part.call(this,"moon","text",r.args,r.args.moonlight_only?e.signs.moonlight:r.args.no_title?"":a.title);return s.className+=" moon_is_"+a.phase,t.T._sign.call(this,!r.args.no_sign,s,r.args),t.T._unit.call(this,!r.args.no_unit,s,"moon",(r.args.moonlight_only?"":"(")+a.lum+"%"+(r.args.moonlight_only?"":")")),s},n.wind_by_icon=function(r){var e=t.D.langs[this.args.lang],a=t.F.windtrend(r.wind.trend,r.wind.speed,e.winds.full),s=t.T._part.call(this,"wind","icon",r.args,!r.no_sign&&r.speed?e.signs.wind+" "+a.title.toLowerCase():a.title);return s.className+=" wind_is_"+a.alias,s.style.backgroundImage="url("+t.url("icons",{file:a.alias.toUpperCase(),pack:"default",size:r.args.small?"13x13":"26x26",type:"wind"},!1)+")",s},n.wind_by_text=function(r){var e=t.D.langs[this.args.lang],a=t.T._part.call(this,"wind","text",r.args);return t.T._sign.call(this,!r.args.no_sign,a,r.args),r.args.no_speed||a.appendChild(t._.node.call(this,"speed",t.F.windspeed(r.wind.speed,t.D.partner.units.windspeed)+"")),r.args.no_unit||t.T._unit.call(this,!r.args.no_unit,a,"windspeed"),r.args.no_trend||a.appendChild(t._.node.call(this,"trend",t.F.windtrend(r.wind.trend,r.wind.speed,r.args.shortened?e.winds.part:e.winds.full).title)),a},n.when_by_text=function(r){var e=t.T._part.call(this,"when","text",r.args,t.D.langs[this.args.lang].date.parts[r.alias]);return e.className+=" when_is_"+r.alias,e},n.water_by_text=function(r){var e=t.T._part.call(this,"water","text",r.args,r.args.no_value?"":t.F.temperature(r.water,t.D.partner.units.temperature));return r.args.no_sign||t.T._sign.call(this,!r.no_sign,e,r.args),r.args.no_unit||t.T._unit.call(this,!r.no_unit,e,"temperature"),e},n.geomag_by_text=function(r){var e=r.geomag-1,a=t.D.langs[this.args.lang],s=t.T._part.call(this,"geomag","text",r.args,a.geomag[e]);return t.T._sign.call(this,!r.no_sign,s,r.args),t.T._unit.call(this,r.unit,s,"geomag","("+r.geomag+" "+t.F.plural(r.geomag,a.units.geomag[0],a.units.geomag[1],a.units.geomag[2])+")"),s},n.sunset_by_text=function(r){var e=(t.D.langs[this.args.lang],r.astro.sunset.current.replace(/[:-]/g," ").split(" ")),a=t.T._part.call(this,"sunrise","text",r.args,t.F.date(r.args.format?r.args.format:"G:i",new Date(e[0],e[1],e[2],e[3],e[4]),t.D.langs[this.args.lang].date));return t.T._sign.call(this,!r.args.no_sign,a,r.args),a},n.measure_by_text=function(r){var e=t.T._part.call(this,"measure","text",r.args,t.D.langs[this.args.lang].units.measure[r.args.show?r.args.show:"max"][r.args.full?"full":"part"]);return e},n.sunrise_by_text=function(r){var e=(t.D.langs[this.args.lang],r.astro.sunrise.current.replace(/[:-]/g," ").split(" ")),a=t.T._part.call(this,"sunrise","text",r.args,t.F.date(r.args.format?r.args.format:"G:i",new Date(e[0],e[1],e[2],e[3],e[4]),t.D.langs[this.args.lang].date));return t.T._sign.call(this,!r.args.no_sign,a,r.args),a},n.weather_by_icon=function(r){var e=28,a=(r.off.ctxt,t.T._part.call(this,"weather","icon",r.args,r.weather.text));return r.args.large?e=55:r.args.small&&(e=18),a.style.backgroundImage="url("+t.url("icons",{file:r.weather.icon.flatui,pack:"default",size:e+"x--",type:"weather"},!1)+")",a},n.weather_by_text=function(r){var e=t.T._part.call(this,"weather","text",r.args,t.D.langs[this.args.lang][r.off.city][r.off.ctxt][r.off.part]);return t.T._sign.call(this,r.args.sign,e,r.args),e},n.humidity_by_text=function(r){var e=t.T._part.call(this,"humidity","text",r.args,r.humidity+"%");return t.T._sign.call(this,!r.args.no_sign,e,r.args),t.T._unit.call(this,!r.args.no_unit,e,"humidity",t.D.langs[this.args.lang].units.humidity),e},n.pressure_by_text=function(r){var e=t.T._part.call(this,"pressure","text",r.args,t.F.pressure(r.pressure,t.D.partner.units.pressure)+"");return t.T._sign.call(this,!r.args.no_sign,e,r.args),t.T._unit.call(this,!r.args.no_unit,e,"pressure"),e},t}();